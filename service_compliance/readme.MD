Letâ€™s build a real-world compliance playbook using the service_facts module.
This will check if critical services (like sshd, firewalld, docker) are running and enabled, then report compliance results.
ðŸ”¹ Explanation

Gather Facts â†’ Collects service info (ansible_facts.services).

Compliance Check â†’ Loops through the critical_services list and prints state & status.

If a service doesnâ€™t exist, it shows not installed.

Fail on Non-Compliance â†’ If any required service is not running, the play fails for that host.

Save Stats â†’ Stores all service states into compliance_results for reporting.

ðŸ”¹ Example Output (Non-Compliant Host)
TASK [Check compliance for critical services] ***
ok: [web01] => (item=sshd.service) => {
    "msg": "Service sshd.service is running and enabled on web01"
}
ok: [web01] => (item=firewalld.service) => {
    "msg": "Service firewalld.service is stopped and disabled on web01"
}
ok: [web01] => (item=docker.service) => {
    "msg": "Service docker.service is not installed and not installed on web01"
}

TASK [Fail if a critical service is not running] ***
fatal: [web01]: FAILED! => {
    "msg": "Critical service firewalld.service is NOT running on web01"
}
ðŸ”¹ Why is this useful?

âœ… Ensures all servers have required security/services running.
âœ… Immediately fails on non-compliance â†’ great for CIS benchmarks / audits.
âœ… Can be integrated with CI/CD pipelines for automated infra compliance.
