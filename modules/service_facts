#  What is service_facts?
# It gathers details about services (systemd, upstart, sysvinit depending on OS).
# Stores results in the special fact variable: ansible_facts.services
# You can then query which services are running, stopped, enabled, disabled, etc.

# ğŸ”¹ Data Structure Example
# After running service_facts, youâ€™ll have something like:

ansible_facts:
  services:
    sshd.service:
      state: running
      status: enabled
    cron.service:
      state: running
      status: enabled
    nginx.service:
      state: stopped
      status: disabled

# ğŸ”¹ Example 1 â€“ Gather and Print All Services
- name: Collect and display service facts
  hosts: all
  tasks:
    - name: Gather service facts
      ansible.builtin.service_facts:

    - name: Show all service facts
      debug:
        var: ansible_facts.services


# âœ… This will dump the entire list of services with states and enabled status.

# ğŸ”¹ Example 2 â€“ Check If a Service is Running
- name: Check SSHD service
  hosts: all
  tasks:
    - name: Gather service facts
      ansible.builtin.service_facts:

    - name: Ensure sshd is running
      debug:
        msg: "SSHD is running!"
      when: ansible_facts.services['sshd.service'].state == "running"


# âœ… Prints the message only if sshd is active.

# ğŸ”¹ Example 3 â€“ Restart a Service If Itâ€™s Stopped
- name: Restart stopped services
  hosts: all
  tasks:
    - name: Gather service facts
      ansible.builtin.service_facts:

    - name: Restart nginx if stopped
      ansible.builtin.service:
        name: nginx
        state: restarted
      when: ansible_facts.services['nginx.service'].state != "running"


# âœ… Restarts nginx only if itâ€™s not already running.

# ğŸ”¹ Example 4 â€“ List All Running Services
- name: List running services
  hosts: all
  tasks:
    - name: Gather service facts
      ansible.builtin.service_facts:

    - name: Show running services
      debug:
        msg: "{{ item.key }} is running"
      loop: "{{ ansible_facts.services | dict2items }}"
      when: item.value.state == "running"


# âœ… Loops through all services and prints only the ones running.

# ğŸ”‘ When to use service_facts?
# For compliance checks (e.g., â€œIs firewall running on all servers?â€).
# Before performing restarts, upgrades, or patches.
# To dynamically adapt playbooks based on service states.
